var K=Object.defineProperty;var Q=(i,e,t)=>e in i?K(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var M=(i,e,t)=>(Q(i,typeof e!="symbol"?e+"":e,t),t);import{c as z}from"../chunks/camperpins-service.5c14c325.js";import{S as V,i as B,s as R,k as w,l as O,m as T,h as u,n as v,p as x,b as $,I as D,J as ee,o as q,V as te,y as j,a as U,z as I,c as Z,H as G,A as P,g as k,d as E,B as A}from"../chunks/index.147df613.js";import{M as oe}from"../chunks/MainNavigator.38550f66.js";import{T as ae}from"../chunks/TitleBar.64d8cee7.js";import{l as g}from"../chunks/leaflet-src.b319a27c.js";import"../chunks/paths.5406ee9a.js";import{l as H,u as se,a as _}from"../chunks/stores.1f488022.js";import{d as N}from"../chunks/data-mod.f6d667d5.js";import{g as ne}from"../chunks/navigation.3fff38e4.js";const re=!1,ve=Object.freeze(Object.defineProperty({__proto__:null,ssr:re},Symbol.toStringTag,{value:"Module"}));class ie{constructor(e,t,a=""){M(this,"imap",{});M(this,"control",{});M(this,"overlays",{});M(this,"baseLayers",{Terrain:g.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:17,attribution:'Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'}),Satellite:g.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"})});let n=this.baseLayers.Terrain;a&&(n=this.baseLayers[a]),this.imap=g.map(e,{center:[t.location.lat,t.location.lng],zoom:t.zoom,minZoom:t.minZoom,zoomControl:!1,layers:[n]})}addLayer(e,t){this.overlays[e]=t,this.imap.addLayer(t)}addLayerGroup(e){this.overlays[e]=g.layerGroup([]),this.imap.addLayer(this.overlays[e])}showLayerControl(){this.control=g.control.layers(this.baseLayers,this.overlays).addTo(this.imap)}terrainLayerControl(){this.control=g.control.layers(this.baseLayers.Terrain,this.overlays).addTo(this.imap)}satelliteLayerControl(){this.control=g.control.layers(this.baseLayers.Satellite,this.overlays).addTo(this.imap)}showZoomControl(e="topleft"){g.control.zoom({position:e}).addTo(this.imap)}moveTo(e,t){this.imap.setZoom(e),this.imap.panTo(new g.LatLng(t.lat,t.lng))}zoomTo(e){this.imap.setView(new g.LatLng(e.lat,e.lng),8)}addMarker(e,t="",a="default"){let n={},l=g.marker([e.lat,e.lng]);if(t){var c=g.popup({autoClose:!1,closeOnClick:!1});c.setContent(t),l.bindPopup(c)}this.overlays[a]?n=this.overlays[a]:(n=g.layerGroup([]),this.overlays[a]=n,this.imap.addLayer(n)),l.addTo(n)}invalidateSize(){this.imap.invalidateSize(),this.imap._onResize()}onClickAddMarker(e){this.imap.on("click",t=>{let a="";this.addMarker(t.latlng,a),H.set({lat:t.latlng.lat,long:t.latlng.lng})})}}function le(i){let e;return{c(){e=w("div"),this.h()},l(t){e=O(t,"DIV",{class:!0,id:!0,style:!0}),T(e).forEach(u),this.h()},h(){v(e,"class","box"),v(e,"id","pin-map"),x(e,"height",i[0]+"vh")},m(t,a){$(t,e,a)},p(t,[a]){a&1&&x(e,"height",t[0]+"vh")},i:D,o:D,d(t){t&&u(e)}}}function me(i,e,t){let a;ee(i,se,o=>t(9,a=o));let{layerCategoryObjs:n=[]}=e,{pinObjs:l=[]}=e,{height:c=75}=e,{location:f={lat:53.2734,lng:-7.7783203}}=e,{zoom:p=8}=e,d=[],s="pin",r=null;const y={location:f,zoom:p,minZoom:1,layers:d},S=a.email;q(()=>{t(5,r=new ie("pin-map",y)),r.showZoomControl(),console.log("mounting map template"),r.onClickAddMarker()});function J(){console.log(`layerCategoryObjs: ${n}`),console.log(`pinObjs: ${l}`),d=N.getDistinct(N.stripCategoryName(n));for(let o=0;o<d.length;o++){const m=d[o];s=m,r.addLayerGroup(m);const b=n.filter(h=>h.category==m),C=l.filter(h=>b.map(L=>L.pinId).includes(h._id));console.log(m),console.log(`layerPins ${o}: ${C.map(h=>h.name)}`),C.forEach(h=>{W(r,h)})}r.showLayerControl()}function W(o,m){let b="";m.name?b=`<a href="/pin/${m._id}">${m.name}</a>`:b=`<a href="/pin/${m._id}">Add pin information</a>`,o.addMarker({lat:m.lattitude,lng:m.longitude},b,s)}async function X(o){console.log("attempting to add pin");const C=(await z.getUsers()).find(F=>F.email===S)._id;console.log(C);const h={userid:C,lattitude:o.lat.toString(),longitude:o.long.toString()},L=await z.addPin(h);if(L)return console.log("Pin added"),_.lat=o.lat,_.long=o.long,console.log(`last pin: ${_.lat} ${_.long}`),ne(`/pin/${L._id}`),L;console.log("Pin add error")}const Y=H.subscribe(o=>{if(o.long&&o.long!==_.long&&o.lat&&o.lat!==_.lat){console.log(`New pin at long ${o.long} and lat ${o.lat}`);const m={lat:o.lat,long:o.long};X(m)}});return te(Y),i.$$set=o=>{"layerCategoryObjs"in o&&t(1,n=o.layerCategoryObjs),"pinObjs"in o&&t(2,l=o.pinObjs),"height"in o&&t(0,c=o.height),"location"in o&&t(3,f=o.location),"zoom"in o&&t(4,p=o.zoom)},i.$$.update=()=>{i.$$.dirty&38&&n&&l&&r&&J()},[c,n,l,f,p,r]}class ce extends V{constructor(e){super(),B(this,e,me,le,R,{layerCategoryObjs:1,pinObjs:2,height:0,location:3,zoom:4})}}function ge(i){let e,t,a,n,l,c,f,p,d;return a=new ae({props:{subTitle:"Pin map",title:"Camperpins Inc."}}),c=new oe({}),p=new ce({props:{layerCategoryObjs:i[0],pinObjs:i[1],height:80,location:{lat:53.2734,lng:-7.7783203},zoom:7}}),{c(){e=w("div"),t=w("div"),j(a.$$.fragment),n=U(),l=w("div"),j(c.$$.fragment),f=U(),j(p.$$.fragment),this.h()},l(s){e=O(s,"DIV",{class:!0});var r=T(e);t=O(r,"DIV",{class:!0});var y=T(t);I(a.$$.fragment,y),y.forEach(u),n=Z(r),l=O(r,"DIV",{class:!0});var S=T(l);I(c.$$.fragment,S),S.forEach(u),r.forEach(u),f=Z(s),I(p.$$.fragment,s),this.h()},h(){v(t,"class","column is-two-thirds"),v(l,"class","column"),v(e,"class","columns is-vcentered")},m(s,r){$(s,e,r),G(e,t),P(a,t,null),G(e,n),G(e,l),P(c,l,null),$(s,f,r),P(p,s,r),d=!0},p(s,[r]){const y={};r&1&&(y.layerCategoryObjs=s[0]),r&2&&(y.pinObjs=s[1]),p.$set(y)},i(s){d||(k(a.$$.fragment,s),k(c.$$.fragment,s),k(p.$$.fragment,s),d=!0)},o(s){E(a.$$.fragment,s),E(c.$$.fragment,s),E(p.$$.fragment,s),d=!1},d(s){s&&u(e),A(a),A(c),s&&u(f),A(p,s)}}}function pe(i,e,t){let a,n;async function l(){console.log("getting categories"),t(0,a=await z.getCategories()),console.log(`response: ${a}`),console.log(`single: ${a[0].category}`),console.log("getting pins"),t(1,n=await z.getPins()),console.log(`response: ${n}`),console.log(`single: ${n[0].name}`)}return q(async()=>{l()}),[a,n]}class Se extends V{constructor(e){super(),B(this,e,pe,ge,R,{})}}export{Se as component,ve as universal};
